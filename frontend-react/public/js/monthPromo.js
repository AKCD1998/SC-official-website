const promoImages = [
  { src: "images/SC-promotion/Januaray 2026/promo.jpg", title: "???????? 1", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (2).jpg", title: "???????? 2", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (3).jpg", title: "???????? 3", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (4).jpg", title: "???????? 4", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (5).jpg", title: "???????? 5", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (6).jpg", title: "???????? 6", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (7).jpg", title: "???????? 7", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (8).jpg", title: "???????? 8", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (9).jpg", title: "???????? 9", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (10).jpg", title: "???????? 10", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (11).jpg", title: "???????? 11", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (12).jpg", title: "???????? 12", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (13).jpg", title: "???????? 13", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (14).jpg", title: "???????? 14", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (15).jpg", title: "???????? 15", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (16).jpg", title: "???????? 16", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (17).jpg", title: "???????? 17", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (18).jpg", title: "???????? 18", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (19).jpg", title: "???????? 19", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (20).jpg", title: "???????? 20", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (21).jpg", title: "???????? 21", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (22).jpg", title: "???????? 22", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (23).jpg", title: "???????? 23", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (24).jpg", title: "???????? 24", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (25).jpg", title: "???????? 25", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (26).jpg", title: "???????? 26", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (27).jpg", title: "???????? 27", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (28).jpg", title: "???????? 28", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (29).jpg", title: "???????? 29", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (30).jpg", title: "???????? 30", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (31).jpg", title: "???????? 31", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (32).jpg", title: "???????? 32", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (33).jpg", title: "???????? 33", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (34).jpg", title: "???????? 34", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (35).jpg", title: "???????? 35", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (36).jpg", title: "???????? 36", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (37).jpg", title: "???????? 37", desc: "???????????????" },
  { src: "images/SC-promotion/Januaray 2026/promo (38).jpg", title: "???????? 38", desc: "???????????????" },
];


const el = document.getElementById("promoCarousel");

if (el) {
  // 1) build html
  el.innerHTML = promoImages.map(p => `
    <div class="item promo-item">
      <img src="${p.src}" class="img-responsive promo-img" alt="${p.title}">
    </div>
  `).join("");

  // 2) init owl AFTER adding items (jQuery required)
  $(el).owlCarousel({
    items: 3,
    loop: true,
    margin: 20,
    autoplay: true,
    autoplayTimeout: 3500,
    responsive: {
      0: { items: 1 },
      768: { items: 2 },
      992: { items: 3 }
    }
  });
}

const modal = document.getElementById("promoModal");
const modalImg = document.getElementById("promoModalImg");
const modalStage = modal ? modal.querySelector(".promo-modal-stage") : null;

if (el && modal && modalImg && modalStage) {
  modalImg.setAttribute("draggable", "false");
  const MIN_SCALE = 1;
  const MAX_SCALE = 4;
  let scale = 1;
  let translateX = 0;
  let translateY = 0;
  let isDragging = false;
  let dragStartX = 0;
  let dragStartY = 0;

  const applyTransform = () => {
    modalImg.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
  };

  const setScale = next => {
    scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, next));
    if (scale === MIN_SCALE) {
      translateX = 0;
      translateY = 0;
    }
    applyTransform();
  };

  const openModal = (src, alt) => {
    modalImg.src = src;
    modalImg.alt = alt || "";
    scale = 1;
    translateX = 0;
    translateY = 0;
    applyTransform();
    modal.classList.add("is-open");
    modal.setAttribute("aria-hidden", "false");
    document.body.classList.add("promo-modal-open");
  };

  const closeModal = () => {
    modal.classList.remove("is-open");
    modal.setAttribute("aria-hidden", "true");
    document.body.classList.remove("promo-modal-open");
  };

  el.addEventListener("click", e => {
    const img = e.target.closest(".promo-img");
    if (!img) return;
    openModal(img.getAttribute("src"), img.getAttribute("alt"));
  });

  modal.addEventListener("click", e => {
    if (e.target.matches("[data-action='close']")) {
      closeModal();
    }
  });

  modal.addEventListener("wheel", e => {
    if (!modal.classList.contains("is-open")) return;
    e.preventDefault();
    const delta = e.deltaY < 0 ? 0.2 : -0.2;
    setScale(scale + delta);
  }, { passive: false });

  modal.addEventListener("click", e => {
    const action = e.target.getAttribute("data-action");
    if (!action) return;
    if (action === "zoom-in") setScale(scale + 0.2);
    if (action === "zoom-out") setScale(scale - 0.2);
    if (action === "zoom-reset") setScale(1);
  });

  const startDrag = (clientX, clientY) => {
    if (scale <= 1) return;
    isDragging = true;
    dragStartX = clientX - translateX;
    dragStartY = clientY - translateY;
    modalStage.classList.add("is-dragging");
  };

  const moveDrag = (clientX, clientY) => {
    if (!isDragging) return;
    translateX = clientX - dragStartX;
    translateY = clientY - dragStartY;
    applyTransform();
  };

  const endDrag = () => {
    isDragging = false;
    modalStage.classList.remove("is-dragging");
  };

  modalImg.addEventListener("mousedown", e => {
    e.preventDefault();
    startDrag(e.clientX, e.clientY);
  });

  document.addEventListener("mousemove", e => {
    moveDrag(e.clientX, e.clientY);
  });

  document.addEventListener("mouseup", endDrag);

  modalImg.addEventListener("touchstart", e => {
    if (e.touches.length !== 1) return;
    const t = e.touches[0];
    startDrag(t.clientX, t.clientY);
  }, { passive: true });

  document.addEventListener("touchmove", e => {
    if (!isDragging || e.touches.length !== 1) return;
    const t = e.touches[0];
    moveDrag(t.clientX, t.clientY);
  }, { passive: true });

  document.addEventListener("touchend", endDrag);

  document.addEventListener("keydown", e => {
    if (e.key === "Escape" && modal.classList.contains("is-open")) {
      closeModal();
    }
  });
}
